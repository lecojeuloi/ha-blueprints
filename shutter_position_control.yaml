blueprint:
  name: Shutter Multi-Phase Control
  description: >
    EN: Multi-phase shutter control (pre-open, open, pre-close, close) with
    from/to positions, tolerances, randomization and notifications.

    FR: Contrôle multi-phase des volets (pré-ouverture, ouverture, pré-fermeture,
    fermeture) avec positions from/to, tolérances, randomisation et notifications.
  domain: automation
  mode: single

input:

  ############################################################
  # SECTION 1 : PRE-OPEN
  ############################################################
  pre_open_section:
    name: "Pré-ouverture / Pre-open"
    icon: mdi:window-shutter-open
    collapsed: true
    input:

      pre_open_enabled:
        name: "Activer la phase pré-ouverture / Enable pre-open phase"
        description: >
          EN: Enable or disable this phase.
          
          FR: Active ou désactive cette phase.
        default: false
        selector:
          boolean: {}

      pre_open_covers:
        name: "Volets pré-ouverture / Pre-open covers"
        description: >
          EN: Shutters controlled by this phase.
          
          FR: Volets contrôlés par cette phase.
        selector:
          entity:
            domain: cover
            multiple: true

      pre_open_use_from:
        name: "Filtrer par position de départ ? / Use from position filter?"
        description: >
          EN: If enabled, only shutters within [from ± tolerance] will move.
          
          FR: Si activé, seuls les volets dans [from ± tolérance] bougeront.
        default: false
        selector:
          boolean: {}

      pre_open_from:
        name: "From (%) – position de départ"
        description: >
          EN: Starting position used when the from filter is enabled.
          
          FR: Position de départ utilisée si le filtre from est activé.
        default: 0
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      pre_open_from_tolerance:
        name: "Tolérance from (%)"
        description: >
          EN: Allowed deviation around the from position (absolute).
          
          FR: Marge de tolérance autour de la position from (valeur absolue).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      pre_open_to:
        name: "To (%) – position cible"
        description: >
          EN: Target position for this phase.
          
          FR: Position cible pour cette phase.
        default: 40
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      pre_open_use_to_random:
        name: "Randomiser la position cible ? / Randomize target position?"
        description: >
          EN: If enabled, the final position will be randomized around the target.
          
          FR: Si activé, la position finale sera randomisée autour de la cible.
        default: false
        selector:
          boolean: {}

      pre_open_to_tolerance:
        name: "Tolérance cible (%)"
        description: >
          EN: Random range [to − tol, to + tol] (clamped to 0–100).
          
          FR: Plage aléatoire [to − tol, to + tol] (bornée 0–100).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      pre_open_time:
        name: "Heure de déclenchement / Trigger time"
        description: >
          EN: Base time for this phase (before random delay).
          
          FR: Heure de base pour cette phase (avant le retard aléatoire).
        selector:
          time: {}

      pre_open_time_random_minutes:
        name: "Tolérance d’heure (min) / Time tolerance (min)"
        description: >
          EN: Random delay between 0 and N minutes AFTER the trigger time.
          
          FR: Retard aléatoire entre 0 et N minutes APRÈS l’heure de déclenchement.
        default: 0
        selector:
          number:
            min: 0
            max: 60
            unit_of_measurement: "min"

      pre_open_weekdays:
        name: "Jours d’exécution / Weekdays"
        description: >
          EN: Days on which this phase is allowed to run.
          
          FR: Jours où cette phase peut s’exécuter.
        default:
          - mon
          - tue
          - wed
          - thu
          - fri
        selector:
          select:
            multiple: true
            options:
              - mon
              - tue
              - wed
              - thu
              - fri
              - sat
              - sun

      pre_open_notify_devices:
        name: "Appareils de notification / Notification devices"
        description: >
          EN: mobile_app devices to notify (optional).
          
          FR: Appareils mobile_app à notifier (optionnel).
        default: []
        selector:
          device:
            multiple: true
            integration: mobile_app

      pre_open_notify_title:
        name: "Titre notification / Notification title"
        default: "Volets – Pré-ouverture"
        selector:
          text: {}

      pre_open_notify_message:
        name: "Message notification / Notification message"
        description: >
          EN: Jinja template. Available variables: phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
          
          FR: Template Jinja. Variables dispo : phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
        default: >
          ({{ prefix }}) Phase {{ phase_name }} vers {{ to_pos }}%.
          Volets ayant bougé:
          {% for c in moved_covers %}
            - {{ c }}
          {% endfor %}
          Volets n'ayant pas bougé:
          {% for c, pos in not_moved_positions.items() %}
            - {{ c }} : {{ pos }}%
          {% endfor %}
        selector:
          text:
            multiline: true
    ############################################################
  # SECTION 2 : OPEN
  ############################################################
  open_section:
    name: "Ouverture / Open"
    icon: mdi:window-shutter-open
    collapsed: true
    input:

      open_enabled:
        name: "Activer la phase d’ouverture / Enable open phase"
        description: >
          EN: Enable or disable this phase.
          
          FR: Active ou désactive cette phase.
        default: false
        selector:
          boolean: {}

      open_covers:
        name: "Volets ouverture / Open covers"
        description: >
          EN: Shutters controlled by this phase.
          
          FR: Volets contrôlés par cette phase.
        selector:
          entity:
            domain: cover
            multiple: true

      open_use_from:
        name: "Filtrer par position de départ ? / Use from position filter?"
        description: >
          EN: If enabled, only shutters within [from ± tolerance] will move.
          
          FR: Si activé, seuls les volets dans [from ± tolérance] bougeront.
        default: false
        selector:
          boolean: {}

      open_from:
        name: "From (%) – position de départ"
        description: >
          EN: Starting position used when the from filter is enabled.
          
          FR: Position de départ utilisée si le filtre from est activé.
        default: 40
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      open_from_tolerance:
        name: "Tolérance from (%)"
        description: >
          EN: Allowed deviation around the from position (absolute).
          
          FR: Marge de tolérance autour de la position from (valeur absolue).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      open_to:
        name: "To (%) – position cible"
        description: >
          EN: Target position for this phase.
          
          FR: Position cible pour cette phase.
        default: 100
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      open_use_to_random:
        name: "Randomiser la position cible ? / Randomize target position?"
        description: >
          EN: If enabled, the final position will be randomized around the target.
          
          FR: Si activé, la position finale sera randomisée autour de la cible.
        default: false
        selector:
          boolean: {}

      open_to_tolerance:
        name: "Tolérance cible (%)"
        description: >
          EN: Random range [to − tol, to + tol] (clamped to 0–100).
          
          FR: Plage aléatoire [to − tol, to + tol] (bornée 0–100).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      open_time:
        name: "Heure de déclenchement / Trigger time"
        description: >
          EN: Base time for this phase (before random delay).
          
          FR: Heure de base pour cette phase (avant le retard aléatoire).
        selector:
          time: {}

      open_time_random_minutes:
        name: "Tolérance d’heure (min) / Time tolerance (min)"
        description: >
          EN: Random delay between 0 and N minutes AFTER the trigger time.
          
          FR: Retard aléatoire entre 0 et N minutes APRÈS l’heure de déclenchement.
        default: 0
        selector:
          number:
            min: 0
            max: 60
            unit_of_measurement: "min"

      open_weekdays:
        name: "Jours d’exécution / Weekdays"
        description: >
          EN: Days on which this phase is allowed to run.
          
          FR: Jours où cette phase peut s’exécuter.
        default:
          - mon
          - tue
          - wed
          - thu
          - fri
        selector:
          select:
            multiple: true
            options:
              - mon
              - tue
              - wed
              - thu
              - fri
              - sat
              - sun

      open_notify_devices:
        name: "Appareils de notification / Notification devices"
        description: >
          EN: mobile_app devices to notify (optional).
          
          FR: Appareils mobile_app à notifier (optionnel).
        default: []
        selector:
          device:
            multiple: true
            integration: mobile_app

      open_notify_title:
        name: "Titre notification / Notification title"
        default: "Volets – Ouverture"
        selector:
          text: {}

      open_notify_message:
        name: "Message notification / Notification message"
        description: >
          EN: Jinja template. Available variables: phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
          
          FR: Template Jinja. Variables dispo : phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
        default: >
          ({{ prefix }}) Phase {{ phase_name }} vers {{ to_pos }}%.
          Volets ayant bougé:
          {% for c in moved_covers %}
            - {{ c }}
          {% endfor %}
          Volets n'ayant pas bougé:
          {% for c, pos in not_moved_positions.items() %}
            - {{ c }} : {{ pos }}%
          {% endfor %}
        selector:
          text:
            multiline: true

    ############################################################
  # SECTION 3 : PRE-CLOSE
  ############################################################
  pre_close_section:
    name: "Pré-fermeture / Pre-close"
    icon: mdi:window-shutter
    collapsed: true
    input:

      pre_close_enabled:
        name: "Activer la phase pré-fermeture / Enable pre-close phase"
        description: >
          EN: Enable or disable this phase.
          
          FR: Active ou désactive cette phase.
        default: false
        selector:
          boolean: {}

      pre_close_covers:
        name: "Volets pré-fermeture / Pre-close covers"
        description: >
          EN: Shutters controlled by this phase.
          
          FR: Volets contrôlés par cette phase.
        selector:
          entity:
            domain: cover
            multiple: true

      pre_close_use_from:
        name: "Filtrer par position de départ ? / Use from position filter?"
        description: >
          EN: If enabled, only shutters within [from ± tolerance] will move.
          
          FR: Si activé, seuls les volets dans [from ± tolérance] bougeront.
        default: false
        selector:
          boolean: {}

      pre_close_from:
        name: "From (%) – position de départ"
        description: >
          EN: Starting position used when the from filter is enabled.
          
          FR: Position de départ utilisée si le filtre from est activé.
        default: 100
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      pre_close_from_tolerance:
        name: "Tolérance from (%)"
        description: >
          EN: Allowed deviation around the from position (absolute).
          
          FR: Marge de tolérance autour de la position from (valeur absolue).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      pre_close_to:
        name: "To (%) – position cible"
        description: >
          EN: Target position for this phase.
          
          FR: Position cible pour cette phase.
        default: 40
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      pre_close_use_to_random:
        name: "Randomiser la position cible ? / Randomize target position?"
        description: >
          EN: If enabled, the final position will be randomized around the target.
          
          FR: Si activé, la position finale sera randomisée autour de la cible.
        default: false
        selector:
          boolean: {}

      pre_close_to_tolerance:
        name: "Tolérance cible (%)"
        description: >
          EN: Random range [to − tol, to + tol] (clamped to 0–100).
          
          FR: Plage aléatoire [to − tol, to + tol] (bornée 0–100).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      pre_close_time:
        name: "Heure de déclenchement / Trigger time"
        description: >
          EN: Base time for this phase (before random delay).
          
          FR: Heure de base pour cette phase (avant le retard aléatoire).
        selector:
          time: {}

      pre_close_time_random_minutes:
        name: "Tolérance d’heure (min) / Time tolerance (min)"
        description: >
          EN: Random delay between 0 and N minutes AFTER the trigger time.
          
          FR: Retard aléatoire entre 0 et N minutes APRÈS l’heure de déclenchement.
        default: 0
        selector:
          number:
            min: 0
            max: 60
            unit_of_measurement: "min"

      pre_close_weekdays:
        name: "Jours d’exécution / Weekdays"
        description: >
          EN: Days on which this phase is allowed to run.
          
          FR: Jours où cette phase peut s’exécuter.
        default:
          - mon
          - tue
          - wed
          - thu
          - fri
        selector:
          select:
            multiple: true
            options:
              - mon
              - tue
              - wed
              - thu
              - fri
              - sat
              - sun

      pre_close_notify_devices:
        name: "Appareils de notification / Notification devices"
        description: >
          EN: mobile_app devices to notify (optional).
          
          FR: Appareils mobile_app à notifier (optionnel).
        default: []
        selector:
          device:
            multiple: true
            integration: mobile_app

      pre_close_notify_title:
        name: "Titre notification / Notification title"
        default: "Volets – Pré-fermeture"
        selector:
          text: {}

      pre_close_notify_message:
        name: "Message notification / Notification message"
        description: >
          EN: Jinja template. Available variables: phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
          
          FR: Template Jinja. Variables dispo : phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
        default: >
          ({{ prefix }}) Phase {{ phase_name }} vers {{ to_pos }}%.
          Volets ayant bougé:
          {% for c in moved_covers %}
            - {{ c }}
          {% endfor %}
          Volets n'ayant pas bougé:
          {% for c, pos in not_moved_positions.items() %}
            - {{ c }} : {{ pos }}%
          {% endfor %}
        selector:
          text:
            multiline: true

    ############################################################
  # SECTION 4 : CLOSE
  ############################################################
  close_section:
    name: "Fermeture / Close"
    icon: mdi:window-shutter
    collapsed: true
    input:

      close_enabled:
        name: "Activer la phase de fermeture / Enable close phase"
        description: >
          EN: Enable or disable this phase.
          
          FR: Active ou désactive cette phase.
        default: false
        selector:
          boolean: {}

      close_covers:
        name: "Volets fermeture / Close covers"
        description: >
          EN: Shutters controlled by this phase.
          
          FR: Volets contrôlés par cette phase.
        selector:
          entity:
            domain: cover
            multiple: true

      close_use_from:
        name: "Filtrer par position de départ ? / Use from position filter?"
        description: >
          EN: If enabled, only shutters within [from ± tolerance] will move.
          
          FR: Si activé, seuls les volets dans [from ± tolérance] bougeront.
        default: false
        selector:
          boolean: {}

      close_from:
        name: "From (%) – position de départ"
        description: >
          EN: Starting position used when the from filter is enabled.
          
          FR: Position de départ utilisée si le filtre from est activé.
        default: 40
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      close_from_tolerance:
        name: "Tolérance from (%)"
        description: >
          EN: Allowed deviation around the from position (absolute).
          
          FR: Marge de tolérance autour de la position from (valeur absolue).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      close_to:
        name: "To (%) – position cible"
        description: >
          EN: Target position for this phase.
          
          FR: Position cible pour cette phase.
        default: 0
        selector:
          number:
            min: 0
            max: 100
            unit_of_measurement: "%"

      close_use_to_random:
        name: "Randomiser la position cible ? / Randomize target position?"
        description: >
          EN: If enabled, the final position will be randomized around the target.
          
          FR: Si activé, la position finale sera randomisée autour de la cible.
        default: false
        selector:
          boolean: {}

      close_to_tolerance:
        name: "Tolérance cible (%)"
        description: >
          EN: Random range [to − tol, to + tol] (clamped to 0–100).
          
          FR: Plage aléatoire [to − tol, to + tol] (bornée 0–100).
        default: 0
        selector:
          number:
            min: 0
            max: 20
            unit_of_measurement: "%"

      close_time:
        name: "Heure de déclenchement / Trigger time"
        description: >
          EN: Base time for this phase (before random delay).
          
          FR: Heure de base pour cette phase (avant le retard aléatoire).
        selector:
          time: {}

      close_time_random_minutes:
        name: "Tolérance d’heure (min) / Time tolerance (min)"
        description: >
          EN: Random delay between 0 and N minutes AFTER the trigger time.
          
          FR: Retard aléatoire entre 0 et N minutes APRÈS l’heure de déclenchement.
        default: 0
        selector:
          number:
            min: 0
            max: 60
            unit_of_measurement: "min"

      close_weekdays:
        name: "Jours d’exécution / Weekdays"
        description: >
          EN: Days on which this phase is allowed to run.
          
          FR: Jours où cette phase peut s’exécuter.
        default:
          - mon
          - tue
          - wed
          - thu
          - fri
        selector:
          select:
            multiple: true
            options:
              - mon
              - tue
              - wed
              - thu
              - fri
              - sat
              - sun

      close_notify_devices:
        name: "Appareils de notification / Notification devices"
        description: >
          EN: mobile_app devices to notify (optional).
          
          FR: Appareils mobile_app à notifier (optionnel).
        default: []
        selector:
          device:
            multiple: true
            integration: mobile_app

      close_notify_title:
        name: "Titre notification / Notification title"
        default: "Volets – Fermeture"
        selector:
          text: {}

      close_notify_message:
        name: "Message notification / Notification message"
        description: >
          EN: Jinja template. Available variables: phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
          
          FR: Template Jinja. Variables dispo : phase_name, from_pos, to_pos,
          moved_covers, not_moved_positions, prefix.
        default: >
          ({{ prefix }}) Phase {{ phase_name }} vers {{ to_pos }}%.
          Volets ayant bougé:
          {% for c in moved_covers %}
            - {{ c }}
          {% endfor %}
          Volets n'ayant pas bougé:
          {% for c, pos in not_moved_positions.items() %}
            - {{ c }} : {{ pos }}%
          {% endfor %}
        selector:
          text:
            multiline: true
  
    
